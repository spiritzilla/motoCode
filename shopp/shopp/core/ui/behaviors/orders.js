/*
 * orders.js - Behaviors for the order manager
 * Copyright ?? 2011 by Ingenesis Limited. All rights reserved.
 * Licensed under the GPLv3 {@see license.txt}
 */
jQuery(document).ready(function(g){g.template("shipment-ui",g("#shipment-ui"));g.template("shipnotice-ui",g("#shipnotice-ui"));g.template("refund-ui",g("#refund-ui"));var d=g("#order-manage"),c=d.find("div.headline"),f="",e=g.each(carriers,function(i,j){f+='<option value="'+i+'">'+j[0]+"</option>"}),b=g("#shipnote-button").click(function(p){p.preventDefault();var o=g(this).hide(),n=[],m=g.tmpl("shipnotice-ui",{shipmentnum:2}),j=m.find("ol li"),l=function(){j.find("span.number").text(n.length+1+".")},i=m.find("#addship-button").click(function(u){u.preventDefault();var s=n.length,t=g.tmpl("shipment-ui",{id:s,num:s+1}),r=t.find("select").html(f),v=t.find(".tracking").change(function(){var w=g(this).val().toUpperCase().replace(/[^A-Z0-9]/,"");g.each(carriers,function(y,x){if(w.match(new RegExp(x[1].substr(1,x[1].length-2)))!=null){r.val(y);return false}})}),q=t.find("button.delete").click(function(w){w.preventDefault();t.remove();n.splice(s,1);l()}).hide();if(s>0){t.hover(function(){q.show()},function(){q.fadeOut("fast")})}n.push(t.insertBefore(j));l()}).click(),k=m.find("#cancel-ship").click(function(q){q.preventDefault();m.fadeRemove("fast",function(){o.show()})});m.appendTo(c)}),a=g("#cancel-order, #refund-button").click(function(m){m.preventDefault();var l=g(this).hide(),k=("refund-button"==l.attr("id")?{action:"refund",title:$om.ro,cancel:$om.cancel,send:$om.stg,process:$om.pr,reason:$om.rr}:{action:"cancel",title:$om.co,cancel:$om.dnc,send:$om.stg,process:$om.co,reason:$om.rc,disable_amount:' disabled="disabled"'}),j=g.tmpl("refund-ui",k),i=j.find("#cancel-refund").click(function(n){n.preventDefault();j.fadeRemove("fast",function(){l.show()})});j.appendTo(c)}),h=g("#print-button").click(function(k){k.preventDefault();var l=g("#print-receipt").get(0),i=l.contentWindow;if(g.browser.opera||g.browser.msie){var j=window.open(i.location.href+"&print=auto");g(j).load(function(){j.close()})}else{i.focus();i.print()}return false})});