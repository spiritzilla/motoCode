/*
 * setup.js - General settings screen behaviors
 * Copyright ?? 2008-2010 by Ingenesis Limited
 * Licensed under the GPLv3 {@see license.txt}
 */
jQuery(document).ready(function(e){var a=e("#base_operations"),c=e("#base_operations_zone"),f=e("#activation-status"),b=e("#activation-button").click(function(){e(this).val($sl.connecting).attr("disabled",true).addClass("updating");if(e(this).hasClass("deactivation")){e.getJSON(deact_key_url+"&action=shopp_deactivate_key",d)}else{e.getJSON(act_key_url+"&action=shopp_activate_key&key="+e("#update-key").val(),d)}}).html(activated?$sl.deactivate_button:$sl.activate_button),d=function(g,n,l){var i=b.attr("disabled",false).removeClass("updating"),m=e("#update-key"),k=(g instanceof Array)?g[0]:false,h=(g instanceof Array)?g[1]:false,j=(g instanceof Array)?g[2]:false;if(!g||k===false){i.attr("disabled",true);f.html($sl.k_001).addClass("activating").show();return}if(i.hasClass("deactivation")){i.html($sl.deactivate_button)}else{i.html($sl.deactivate_button)}if(k=="1"){if(j=="dev"&&m.attr("type")=="text"){m.replaceWith('<input type="password" name="updatekey" id="update-key" value="'+m.val()+'" readonly="readonly" size="56" />')}else{m.attr("readonly",true)}i.val($sl.deactivate_button).addClass("deactivation")}else{if(m.attr("type")=="password"){m.replaceWith('<input type="text" name="updatekey" id="update-key" value="" size="56" />')}m.attr("readonly",false);i.val($sl.activate_button).removeClass("deactivation")}if(k!==false){if(k!="0"&&k!="1"){f.addClass("activating")}else{f.removeClass("activating")}k="ks"+k.toString().replace(/\-/,"_");f.html($sl[k]?$sl[k]:"A problem with your WordPress install causing problems with activation/deactivation.").show()}else{f.addClass("activating").show()}};if(activated){d([1],"success")}else{f.show()}if(!a.val()||a.val()==""){c.hide()}if(!c.val()){c.hide()}a.change(function(){if(a.val()==""){c.hide().attr("disabled",true);return true}e.getJSON(zones_url+"&action=shopp_country_zones&country="+a.val(),function(g){c.hide().empty().attr("disabled",true);if(!g){return true}e.each(g,function(i,h){option=e("<option></option>").val(i).html(h).appendTo("#base_operations_zone")});c.show().removeAttr("disabled")})});e("#selectall_targetmarkets").change(function(){if(e(this).attr("checked")){e("#target_markets input").not(this).attr("checked",true)}else{e("#target_markets input").not(this).attr("checked",false)}})});